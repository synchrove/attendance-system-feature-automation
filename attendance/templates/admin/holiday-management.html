{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<style>
.holiday-form {
    background: var(--first-col-bg);
    padding: 20px;
    border-radius: 6px;
    margin-bottom: 20px;
    border: 1px solid var(--border-color);
}
.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}
.form-row.full {
    grid-template-columns: 1fr;
}
.form-group {
    display: flex;
    flex-direction: column;
}
.form-group label {
    margin-bottom: 5px;
    color: var(--text-color);
    font-weight: 500;
}
.form-group input, .form-group select, .form-group textarea {
    padding: 8px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background: var(--bg-color);
    color: var(--text-color);
}
.holiday-item {
    background: var(--bg-color);
    padding: 15px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    margin-bottom: 10px;
}
.holiday-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.btn {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
}
.btn-primary {
    background: #4caf50;
    color: white;
}
.btn-danger {
    background: #f44336;
    color: white;
}
.btn-secondary {
    background: #2196f3;
    color: white;
}
.status-badge {
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}
.status-active {
    background: #4caf50;
    color: white;
}
.status-inactive {
    background: #9e9e9e;
    color: white;
}
.edit-mode {
    background: #fff3cd;
    border-color: #ffc107;
}
</style>
{% endblock %}

{% block content %}
<!-- Navigation -->
<div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;">
  <a class="button" href="/admin/" title="Back to Admin" style="padding:8px 12px;border:1px solid #484848;background:#3a3a3a;border-radius:4px;color:#f8f8f2;text-decoration:none;">‚Üê Back to Admin</a>
</div>

{% if message %}
<div style="color:{% if message_type == 'success' %}#4caf50{% else %}#f44336{% endif %};background:var(--first-col-bg);padding:8px;border-radius:4px;margin-bottom:8px;border:1px solid {% if message_type == 'success' %}#4caf50{% else %}#f44336{% endif %};">
  {% if message_type == 'success' %}‚úÖ{% else %}‚ùå{% endif %} {{ message }}
</div>
{% endif %}

<div class="dashboard-header">
  <img src="{% static 'images/logo.png' %}" alt="Logo" style="height:36px;" />
  <h1 style="margin:0;font-size:16px;color:var(--text-color);">üèñÔ∏è Holiday Management</h1>
</div>

<!-- Create Custom Holiday -->
<div class="holiday-form">
  <h3 style="margin:0 0 15px 0;color:var(--text-color);">Create Custom Holiday</h3>
  
  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="create_holiday" value="1">
    <input type="hidden" name="is_government" value="0">
    
    <div class="form-row">
      <div class="form-group">
        <label>Holiday Name *</label>
        <input type="text" name="name" required placeholder="e.g., Eid Holiday">
      </div>
      <div class="form-group">
        <label>Scope *</label>
        <select name="scope" required>
          <option value="all">All Employees</option>
          <option value="department">Department</option>
          <option value="designation">Designation</option>
          <option value="custom">Selected Employees</option>
        </select>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label>Start Date *</label>
        <input type="date" name="start_date" required>
      </div>
      <div class="form-group">
        <label>End Date *</label>
        <input type="date" name="end_date" required>
      </div>
    </div>
    
    <button type="submit" class="btn btn-primary">Create & Activate</button>
  </form>
</div>

<!-- Create Government Holiday -->
<div class="holiday-form">
  <h3 style="margin:0 0 15px 0;color:var(--text-color);">üáßüá© Create Government Holiday</h3>
  
  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="create_holiday" value="1">
    <input type="hidden" name="is_government" value="1">
    <input type="hidden" name="scope" value="all">
    
    <div class="form-row">
      <div class="form-group">
        <label>Holiday Name *</label>
        <input type="text" name="name" required placeholder="e.g., Independence Day 2025">
      </div>
      <div class="form-group">
        <label>Description</label>
        <input type="text" name="description" placeholder="Optional">
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label>Start Date *</label>
        <input type="date" name="start_date" required>
      </div>
      <div class="form-group">
        <label>End Date *</label>
        <input type="date" name="end_date" required>
      </div>
    </div>
    
    <button type="submit" class="btn btn-primary">Create & Activate</button>
  </form>
</div>

<!-- Auto Generate Bangladesh Holidays -->
<div class="holiday-form">
  <h3 style="margin:0 0 15px 0;color:var(--text-color);">Auto-Generate Bangladesh Holidays</h3>
  
  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="auto_generate_holidays" value="1">
    
    <div style="display:flex;gap:15px;align-items:end;">
      <div class="form-group">
        <label>Year</label>
        <input type="number" name="generate_year" value="{{ current_year }}" min="2020" max="2030">
      </div>
      <button type="submit" class="btn btn-primary">Generate Holidays</button>
    </div>
  </form>
</div>

<!-- Government Holidays List -->
<div style="margin-top:30px;">
  <h3 style="margin:0 0 15px 0;color:var(--text-color);">üáßüá© Government Holidays</h3>
  
  {% for holiday in government_holidays %}
  <div class="holiday-item" id="holiday-{{ holiday.id }}">
    <div class="holiday-header">
      <div>
        <h4 style="margin:0;color:var(--text-color);" class="holiday-name">{{ holiday.name }}</h4>
        <p style="margin:5px 0;color:var(--legend-text);" class="holiday-dates">{{ holiday.start_date }} to {{ holiday.end_date }}</p>
      </div>
      <div style="display:flex;gap:10px;align-items:center;">
        <span class="status-badge {% if holiday.is_active %}status-active{% else %}status-inactive{% endif %}">
          {% if holiday.is_active %}Active{% else %}Inactive{% endif %}
        </span>
        <button onclick="editHoliday({{ holiday.id }}, '{{ holiday.name }}', '{{ holiday.start_date }}', '{{ holiday.end_date }}', {{ holiday.is_active|yesno:'true,false' }})" class="btn btn-secondary">Edit</button>
        <form method="post" style="display:inline;" onsubmit="return confirm('Delete this holiday?');">
          {% csrf_token %}
          <input type="hidden" name="delete_holiday" value="1">
          <input type="hidden" name="holiday_id" value="{{ holiday.id }}">
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </div>
    </div>
  </div>
  {% empty %}
  <div style="text-align:center;padding:20px;color:var(--legend-text);">
    No government holidays yet.
  </div>
  {% endfor %}
</div>

<!-- Custom Holidays List -->
<div style="margin-top:30px;">
  <h3 style="margin:0 0 15px 0;color:var(--text-color);">üìÖ Custom Holidays</h3>
  
  {% for holiday in holidays %}
  <div class="holiday-item" id="holiday-{{ holiday.id }}">
    <div class="holiday-header">
      <div>
        <h4 style="margin:0;color:var(--text-color);" class="holiday-name">{{ holiday.name }}</h4>
        <p style="margin:5px 0;color:var(--legend-text);" class="holiday-dates">{{ holiday.start_date }} to {{ holiday.end_date }}</p>
      </div>
      <div style="display:flex;gap:10px;align-items:center;">
        <span class="status-badge {% if holiday.is_active %}status-active{% else %}status-inactive{% endif %}">
          {% if holiday.is_active %}Active{% else %}Inactive{% endif %}
        </span>
        <button onclick="editHoliday({{ holiday.id }}, '{{ holiday.name }}', '{{ holiday.start_date }}', '{{ holiday.end_date }}', {{ holiday.is_active|yesno:'true,false' }})" class="btn btn-secondary">Edit</button>
        <form method="post" style="display:inline;" onsubmit="return confirm('Delete this holiday?');">
          {% csrf_token %}
          <input type="hidden" name="delete_holiday" value="1">
          <input type="hidden" name="holiday_id" value="{{ holiday.id }}">
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </div>
    </div>
  </div>
  {% empty %}
  <div style="text-align:center;padding:20px;color:var(--legend-text);">
    No custom holidays yet.
  </div>
  {% endfor %}
</div>

<!-- Edit Modal -->
<div id="editModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;">
  <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--bg-color);padding:30px;border-radius:8px;min-width:400px;">
    <h3 style="margin:0 0 20px 0;color:var(--text-color);">Edit Holiday</h3>
    
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="update_holiday" value="1">
      <input type="hidden" name="holiday_id" id="edit_holiday_id">
      
      <div class="form-group" style="margin-bottom:15px;">
        <label>Holiday Name</label>
        <input type="text" name="name" id="edit_name" required>
      </div>
      
      <div class="form-group" style="margin-bottom:15px;">
        <label>Start Date</label>
        <input type="date" name="start_date" id="edit_start_date" required>
      </div>
      
      <div class="form-group" style="margin-bottom:15px;">
        <label>End Date</label>
        <input type="date" name="end_date" id="edit_end_date" required>
      </div>
      
      <div class="form-group" style="margin-bottom:20px;">
        <label style="display:flex;align-items:center;cursor:pointer;">
          <input type="checkbox" name="is_active" value="1" id="edit_is_active" style="margin-right:8px;">
          Active
        </label>
      </div>
      
      <div style="display:flex;gap:10px;">
        <button type="submit" class="btn btn-primary">Save Changes</button>
        <button type="button" onclick="closeEditModal()" class="btn" style="background:#9e9e9e;color:white;">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script>
function editHoliday(id, name, startDate, endDate, isActive) {
  document.getElementById('edit_holiday_id').value = id;
  document.getElementById('edit_name').value = name;
  document.getElementById('edit_start_date').value = startDate;
  document.getElementById('edit_end_date').value = endDate;
  document.getElementById('edit_is_active').checked = isActive;
  document.getElementById('editModal').style.display = 'block';
}

function closeEditModal() {
  document.getElementById('editModal').style.display = 'none';
}

window.onclick = function(event) {
  const modal = document.getElementById('editModal');
  if (event.target == modal) {
    closeEditModal();
  }
}
</script>

{% endblock %}
